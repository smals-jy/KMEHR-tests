---
description: How to test the new KMEHR version impacts on Medication Scheme ?
title: ‚ö†Ô∏è KMEHR 1.40.2 testing (Draft)
---

## Why ?

In a upcoming future, the [Medication Scheme specifications](https://www.ehealth.fgov.be/standards/kmehr/en/transactions/medication-scheme) are going to be updated with a new KMEHR version, more authorized values, ... .
So a testing plan could be handy to prepare your software to that.

## Prerequisites

- Clone the Github project, e.g. `git clone https://github.com/smals-jy/KMEHR-tests`
- Node.JS LTS
- Install Github project dependancies, e.g. `npm install`

## Steps

1. Update the [`template file`](https://github.com/smals-jy/KMEHR-tests/blob/main/TEMPLATES/PARTIAL_MS.xml) to use the new KMEHR version

  ```xml title="TEMPLATES/PARTIAL.xml (Before)"
      <!-- KMEHR 1.28.0 version id -->
      <cd S="CD-STANDARD" SV="1.4">20161201</cd>
  ```

  ```xml title="TEMPLATES/PARTIAL.xml (Before)"
      <!-- KMEHR 1.40.2 version id -->
      <cd S="CD-STANDARD" SV="1.4">20231110</cd>
  ```

2. To generate the resulting XML file(s) in [`output/ms`][MS_OUTPUT_FOLDER] folder :

```bash
npm start
```

3. Check that each testing scenario explained on [the documentation](https://smals-jy.github.io/KMEHR-tests/docs/category/-read-scenarios) still work for you with these updated files

4. Create following new test scenarios in [`configurations/ms`][MS_CONFIG_FOLDER] folder

<details>

      <summary>üç∂ Administration units</summary>

      ```ts title="configurations/ms/BK-01-CD-ADMINISTRATIONUNIT.ts"
        import type { Configuration, AdministrationUnit } from "../../src/config";

        // Same expected results than https://smals-jy.github.io/KMEHR-tests/docs/tests/ms/read/ts-03#expected-results , but with these values
        export default function (): Configuration {
          // List of administration-unit
          const ADMINISTRATION_UNITS: AdministrationUnit[] = [
            // @ts-ignore
            "ampoule",
            // @ts-ignore
            "bandage",
            // @ts-ignore
            "bottle",
            // @ts-ignore
            "box",
            // @ts-ignore
            "effervescent-tablet",
            // @ts-ignore
            "iu",
            // @ts-ignore
            "liter",
            // @ts-ignore
            "meq",
            // @ts-ignore
            "micrograms",
            // @ts-ignore
            "miu",
            // @ts-ignore
            "mmol",
            // @ts-ignore
            "piece",
            // @ts-ignore
            "syringe",
            // @ts-ignore
            "syringe-ampoule"
          ];
        
          // Generate ADMINISTRATION UNIT entries
          return {
            transactions: ADMINISTRATION_UNITS.map((unit, idx) => {
              return {
                id: idx + 2,
                drug: {
                  drugType: "compoundprescription",
                  compoundprescriptionText: `${unit}`,
                  temporality: "chronic",
                  periodicity: "D",
                  regimen: [
                    // To test singular case
                    {
                      quantity: 1.0,
                      timeOfDay: {
                        dayPeriod: "morning",
                      },
                      unit: unit,
                    },
                    // To test plural case
                    {
                      quantity: 5.0,
                      timeOfDay: {
                        dayPeriod: "beforedinner",
                      },
                      unit: unit,
                    },
                  ],
                },
              };
            }),
          };
        }
      ```

</details>

<details>

      <summary>üåÖ Day periods</summary>

      ```ts title="configurations/ms/BK-02-CD-DAYPERIOD.ts"
        import type { Configuration, DayPeriod } from "../../src/config";

        // Same expected results than https://smals-jy.github.io/KMEHR-tests/docs/tests/ms/read/ts-04#expected-results , but with these values
        export default function (): Configuration {
          const periods: DayPeriod[] = [
            // @ts-ignore
            "aftermeal",
            // @ts-ignore
            "betweenmeals",
            // @ts-ignore
            "afternoon",
            // @ts-ignore
            "evening",
            // @ts-ignore
            "night"
          ];
        
          return {
            transactions: [
              {
                id: 2,
                drug: {
                  drugType: "compoundprescription",
                  compoundprescriptionText: "CD-DAYPERIOD Drug",
                  temporality: "chronic",
                  periodicity: "MD",
                  beginmoment: "2023-01-01",
                  regimen: periods.map((p, idx) => ({
                    quantity: 1,
                    dayIngestion: {
                      dayNumber: idx + 1,
                    },
                    timeOfDay: {
                      dayPeriod: p,
                    },
                  })),
                },
              },
            ],
          };
        }

      ```

</details>

<details>

      <summary>üíâ Routes of administration</summary>

      ```ts title="configurations/ms/BK-04-CD-DRUG-ROUTE.ts"
        import type { Configuration, DrugRoute } from "../../src/config";

        // Same expected results than https://smals-jy.github.io/KMEHR-tests/docs/tests/ms/read/ts-05/#expected-results , but with these values
        export default function (): Configuration {
          
            const routes: DrugRoute[] = [
                // Codes that are prohibited from cookbook
                /*
                "00003",
                "00004",
                "00006",
                "00007",
                "00014",
                "00015",
                "00016",
                "00017",
                "00018",
                "00019",
                "00020",
                "00021",
                "00022",
                "00023",
                "00024",
                "00025",
                "00026",
                "00027",
                "00028",
                "00029",
                "00030",
                "00031",
                "00032",
                "00036",
                "00037",
                "00038",
                "00039",
                "00040",
                "00041",
                "00042",
                "00043",
                "00044",
                "00047",
                "00048",
                "00050",
                "00057",
                "00058",
                "00059",
                "00061",
                "00062",
                "00063",
                "00065",
                "00069",
                */
                // Codes that aren't listed in cookbook but possible
                "both_ears",
                "both_eyes",
                "both_nostrils",
                "cutaneous_injection",
                "derm",
                "dermal_injection",
                "ear_left",
                "ear_right",
                "eye_left",
                "eye_right",
                "hyperdermoclyse",
                "icut",
                "ider",
                "larter",
                "nose_left",
                "nose_right",
                "oft",
                "transdermal",
                "vitreal_injection",
            ];  
        
          return {
            transactions: routes.map((r, idx) => ({
              id: idx + 2,
              drug: {
                drugType: "compoundprescription",
                compoundprescriptionText: `${r}`,
                temporality: "chronic",
                periodicity: "D",
                posologyFreeText: `...`,
                route: r,
              },
            })),
          };
        }


      ```

</details>

<details>

      <summary>‚è∞ Frequencies</summary>

      ```ts title="configurations/ms/BK-05-CD-PERIODICITY.ts"
        import type { Configuration, Periodicity } from "../../src/config";
        
        // Same expected results than https://smals-jy.github.io/KMEHR-tests/docs/tests/ms/read/ts-06#expected-results , but with these values
        export default function (): Configuration {
          const frequencies: Periodicity[] = [
            // @ts-ignore
            "ondemand",
            // @ts-ignore
            "UE",
            // @ts-ignore
            "UN",
            // @ts-ignore
            "UQ",
            // @ts-ignore
            "US",
            // @ts-ignore
            "UX",
          ];
        
          return {
            transactions: frequencies.map((f, idx) => ({
              id: idx + 2,
              drug: {
                drugType: "compoundprescription",
                compoundprescriptionText: `${f}`,
                temporality: "chronic",
                posologyFreeText: `...`,
                periodicity: f,
                // As some values go to 6 years, I have to take one date
                beginmoment: "2015-09-16",
              },
            })),
          };
        }


      ```

</details>


[MS_OUTPUT_FOLDER]: https://github.com/smals-jy/KMEHR-tests/tree/main/output/ms
[MS_CONFIG_FOLDER]: https://github.com/smals-jy/KMEHR-tests/tree/main/configurations/ms
